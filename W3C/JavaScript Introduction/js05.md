# Module 5: Working with Forms

## 1. Math 物件
- **靜態屬性與方法**（不需 `new`）：`Math.PI`、`Math.E`、`Math.SQRT2`...
- **亂數與工具**
```jsx
Math.random(); // [0, 1)

const rand = (min, max) => Math.random() * (max - min) + min;
const randInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
const pick = arr => arr[Math.floor(Math.random() * arr.length)];

const cryptoInt = (min, max) => {
  const a = new Uint32Array(1);
  crypto.getRandomValues(a);
  return min + (a[0] % (max - min + 1));
};
```

- **取整與夾值**
```jsx
Math.round(2.5); // 3
Math.ceil(2.1);  // 3
Math.floor(2.9); // 2
Math.trunc(-2.9);// -2

const roundTo = (x, n=0) => Math.round(x * 10**n) / 10**n;
const clamp = (v, min, max) => Math.min(Math.max(min, v), max);
```

- **幾何與角度**
```jsx
const dist = (x1,y1,x2,y2) => Math.hypot(x2-x1, y2-y1);
const toDeg = rad => rad * 180 / Math.PI;
const toRad = deg => deg * Math.PI / 180;
const angle = (dx, dy) => Math.atan2(dy, dx);
```

## 2. Date 物件
- **建立方式**
```jsx
new Date();                   // 現在
Date.now();                   // 毫秒時間戳
new Date('2025-08-14');       // ISO 格式
new Date(2025, 7, 14);        // 注意月份 0–11
```

- **取得/設定**
```jsx
d.getFullYear(); d.getMonth(); d.getDate(); d.getDay();
new Date(2017, 11, 32); // 自動進位
```

- **格式化**
```jsx
new Date().toISOString();
new Date().toLocaleString('zh-Hant-TW');

const fmt = new Intl.DateTimeFormat('zh-Hant-TW', {
  dateStyle: 'medium',
  timeStyle: 'short'
});
fmt.format(new Date());
```

- **計算**
```jsx
const addDays = (d, n) => new Date(d.getTime() + n*86400000);
```

## 3. HTML 表格
```html
<table>
  <caption>2025 Q1 銷售表</caption>
  <thead>
    <tr><th scope="col">品項</th><th scope="col">數量</th><th scope="col">金額</th></tr>
  </thead>
  <tbody>
    <tr><th scope="row">A 產品</th><td>12</td><td>$3,600</td></tr>
  </tbody>
</table>
```

- `scope="col|row"` 有助可近性
- 動態生成可用 `insertRow()` / `insertCell()`

## 4. 表單與 HTML5 驗證
- `<label for>` 對應輸入 ID
- 使用 `type` 屬性獲取原生驗證
- `:invalid` 可樣式化
```html
<form id="signup">
  <label for="email">Email</label>
  <input id="email" name="email" type="email" required />
  <button>送出</button>
</form>
<script>
signup.addEventListener('submit', e => {
  e.preventDefault();
  if (!signup.reportValidity()) return;
  const data = Object.fromEntries(new FormData(signup));
  console.log(data);
});
</script>
```

## 5. JSON 與 Fetch
```jsx
JSON.stringify(obj);
JSON.parse(str);

async function getData(){
  const res = await fetch(url);
  if (!res.ok) throw new Error(res.status);
  return res.json();
}

async function postData(data){
  const res = await fetch('/api', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  });
  if (!res.ok) throw new Error(res.status);
  return res.json();
}
```

## 6. Web Storage
```jsx
localStorage.setItem('key', 'value');
localStorage.getItem('key');

localStorage.setItem('list', JSON.stringify(arr));
const arr = JSON.parse(localStorage.getItem('list') || '[]');
```
- 容量 ~5–10MB，適合小量資料
- 嚴禁存敏感資訊

## 7. Contact Manager 範例
```jsx
class Contact { constructor(name, email){ this.name = name; this.email = email; } }
class ContactManager {
  constructor(){ this.list = []; }
  add(c){ this.list.push(c); }
  remove(c){ this.list = this.list.filter(x => x.email !== c.email); }
  sort(){ this.list.sort((a,b) => a.name.localeCompare(b.name, 'zh-Hant')); }
  save(){ localStorage.setItem('contacts', JSON.stringify(this.list)); }
  load(){ this.list = JSON.parse(localStorage.getItem('contacts') || '[]'); }
  render(sel){
    const el = document.querySelector(sel);
    if (!this.list.length){ el.innerHTML = '<p>No contacts</p>'; return; }
    const tbl = document.createElement('table');
    const head = tbl.createTHead().insertRow();
    ['姓名','Email'].forEach(t => head.insertCell().outerHTML = `<th>${t}</th>`);
    const body = tbl.createTBody();
    this.list.forEach(c => { const r = body.insertRow(); r.innerHTML = `<td>${c.name}</td><td>${c.email}</td>`; });
    el.innerHTML = ''; el.appendChild(tbl);
  }
}
```

## 8. 易錯提醒
- `Math` 不能 `new`
- `Math.atan2` 參數順序 `(y, x)`
- `Date` 月份 0–11
- `localStorage` 僅存字串
- Fetch 錯誤需檢查 `res.ok`

## 9. 實作
- 寫 `randInt` 與 `clamp`
- 滑鼠追逐動畫
- `Intl.DateTimeFormat` 顯示多地區時間
- 動態生成 10 筆表格資料
- 表單驗證後顯示回傳 JSON
- Contact Manager 加搜尋與刪除

## 10. 參考資源
- MDN：Math / Date / Tables / Forms / JSON / Fetch / Web Storage / Intl
- Web.dev：表單 UX / 可近性最佳實踐

## 11. 總結
- **Math**：亂數、取整、角度轉換是互動應用基礎
- **Date**：優先 ISO 與 `Intl`，注意月份與時區
- **表格/表單**：語意化與驗證先行
- **JSON+Fetch**：加錯誤檢查
- **Web Storage**：適合小量資料，敏感資訊另尋安全存法
